<?php
require("includes/init.php");
require("Models/ShopModel.php");
require("Models/OrderModel.php");
include 'request/LogisticsOnlineSendRequest.php';
use Models\ShopModel;
use Models\OrderModel;
require("Services/ExpressApiService.php");
use Services\ExpressApiService;
include 'request/OrderNumberListGetRequest.php';
include 'PddClient.php';

global $oms_db;
$oms_db_conf = array(
    "host" => "100.65.1.202:32001",
    "user" => "mddomsapi",
    "pass" => "123JoisnD0",
    "charset" => "utf8",
    "pconnect" => "1",
    "name" => "mddoms_0"
);
$oms_db = ClsPdo::getInstance($oms_db_conf);

global $oms_user_db;
$oms_user_db_conf = array(
    "host" => "100.65.1.202:32001",
    "user" => "mddomsapi",
    "pass" => "123JoisnD0",
    "charset" => "utf8",
    "pconnect" => "1",
    "name" => "mddomsuser"
);
$oms_user = ClsPdo::getInstance($oms_user_db_conf);

global $oms_sync_db;
$oms_sync_db_conf = array(
    "host" => "100.65.2.110:32057",
    "user" => "mddomsapi_sync",
    "pass" => "123JoisnD0",
    "charset" => "utf8",
    "pconnect" => "1",
    "name" => "mddomssync"
);
$oms_sync_db = ClsPdo::getInstance($oms_sync_db_conf);

$pre_ids = ['4849361107639669849A','4848574286810197980A','4847851336443733219A','4844105223025442344A','4841154610543408692A',
    '4840773767212774839A','4851913318937396794A','4848964815306228752A','4845208299484915109A','4844498800928400521A','4851903724007119982A','4851526539961079589A','4851188865327781531A','4848576103584685056A','4847076618831191525A','4846703094122843261A','4846700504247960678A','4846699104107471934A','4845249462429691832A','4845236190984709307A','4845219603816371676A','4843734262399180365A','4843734008992665165A','4852285203016916807A','4850090049497775881A','4851933509587471865A','4851930378557154593A','4851891852688954903A','4851196695060793304A','4851196016455632772A','4851151189887430406A','4848988471986488872A','4852276729027083281A','4851933754403265987A','4851932307002840191A','4851917072744438958A','4851549685538538873A','4851541649644152406A','4851535387631214514A','4852286551623843395A','4851910278114697014A','4851895928626873964A','4852272348142802298A','4851923081409052584A','4851914732006278958A','4845963243055493027A','4852261778226920828A','4851925340549975150A','4851895215656584603A','4851895172697777772A','4851533605183145590A','4851196325683307972A','4851183466550931289A','4851183397849959910A','4851183410720527719A','4851176839443866947A','4851176843728502660A','4851176839416550821A','4851176830837972967A','4851161149916822768A','4851160913678339823A','4851142179050931718A','4851142213404254008A','4850797782787022663A','4850797769898944261A','4850797748450766338A','4850797739847224699A','4850790653145571206A','4850082739451666239A','4850082524701615956A','4850074995636688744A','4850074892545200070A','4850065684148700493A','4850065748557420444A','4850065628304760180A','4850065606829268233A','4850055492181779675A','4850049298857209536A','4850046507128765917A','4850029202701903770A','4850029219874200968A','4850029138263850813A','4850024482529009036A','4849374769924383891A','4849374688343002844A','4849374580953711968A','4849358500597945622A','4849332503169058567A','4849312080586923701A','4849312080591545517A','4849297705325420278A','4849297761160725691A','4849297658088477965A','4849292263662739283A','4849292173413844495A','4852291954668164601A','4852291885965057349A','4852286886601567704A','4852285662556307073A','4852285585239563267A','4852283545129043324A','4852283454935936865A','4852283437755043598A','4852274847838444870A','4852274611586991583A','4852260111805437456A','4852259287145627302A','4852258045905935445A','4852257972892917433A','4852257659357194067A','4852257659353540536A','4852257642194591142A','4852252784565825014A','4851959249314998208A','4851924872397397353A','4851922905312575239A','4851919203053637471A','4851918631818398774A','4851918460033707078A','4851917854429271145A','4851917184410180814A','4851915831496578283A','4851910677531629338A','4851910110605512487A','4851909470655469103A','4851907847167317741A','4851906691849240313A','4851905703971699719A','4851905347481747159A','4851905295936139116A','4851904114833790065A','4851903006730179694A','4851893927159965304A','4851892213484931035A','4851891028057579153A','4851889602145507028A','4851888532680924833A','4851885371581455685A','4851883846891381835A','4851883748119973023A','4851560448726968281A','4851556815193488449A','4851556759349136591A','4851556428630763112A','4851552348417462226A','4851551738525441540A','4851551227436766592A','4851551042746959702A','4851549135788943101A','4851541465038183588A','4851535031102854461A','4851533283057817061A','4851525255761937490A','4851520144765425095A','4851519092501417880A','4851511511881793478A','4851199649990825657A','4851198215469360904A','4851194513215569079A','4851192829589466751A','4851179296145233657A','4851162820655032217A','4851162799173721740A','4851158864997295468A','4851158414026915454A','4851158066131312614A','4851155416140385822A','4851155360307521326A','4851154857798493337A','4851151627978015901A','4851139632125427609A','4851138803196495099A','4851138743082466771A','4851138708708638678A','4850814442964238194A','4850811208861423129A','4850810964048123491A','4850809117219596074A','4850807055627621494A','4850806389917388260A','4850806286840796686A','4850802524455230679A','4850802167962177095A','4850799831507310450A','4850798736290387839A','4850798439933613405A','4850797422011727380A','4850797198696963604A','4850792074780677789A','4849305307431917543A','4849006497958712995A','4851545536620226304A','4849294372445931078A','4852290739194598929A','4852286229492491267A','4852275122732543455A','4851543655419135615A','4852258758895847364A','4849285567751325576A','4852256989344764954A','4851934355692361391A','4851932285524938582A','4851932229682332676A','4851931941915575657A','4851931761532258062A','4851917566656300875A','4851917575252524264A','4851917553779434813A','4851917553792573270A','4851917540921955944A','4851917558068090677A','4851917549485671534A','4851917506531083782A','4851901915819136920A','4851901829919784049A','4851901838494880772A','4851901855666394310A','4851901808425944437A','4851901812725032096A','4851901791242346073A','4851538909455879418A','4851526681688122519A','4851190162435515436A','4851190175305090261A','4851190153824878054A','4851190132351491531A','4851190162425189815A','4851190123776425182A','4851190171006474126A','4851189999203850166A','4851159706794330044A','4851145645113173914A','4851145636492940624A','4851145593541842854A','4851145593539876028A','4851145610715708498A','4851145610712892689A','4851145576353283373A','4851145580661059469A','4851145580668967996A','4851145580660899220A','4851145602125662043A','4851145597838939619A','4851145245638481227A','4851145567778254288A','4851145572063077876A','4851145554899457805A','4851145554888230030A','4850804710575381899A','4850804719174374974A','4850804701981353084A','4850804676208936078A','4850804723451733384A','4850804714878625682A','4850804736340465534A','4850804706292341980A','4850804740633596971A','4850804706278170041A','4850804710577710750A','4850804710569919575A','4850804663332373637A','4850797370470389426A','4850796494324877215A','4850796490009534037A','4850796464244368768A','4850796507187713799A','4850796524358969266A','4850796481425679995A','4850796524360373703A','4850796485728495374A','4850788698937009672A','4850788690338468906A','4850788668874532632A','4850788686054891328A','4850788681751912397A','4850788690342102784A','4850788634507203619A','4850788673166622536A','4850788664570500294A','4850788552936045654A','4850785499186894730A','4850785344571573756A','4850785331699684977A','4850785344564958769A','4850785159887324894A','4850785095474255330A','4850785069717425471A','4850785091164939677A','4850785078277743720A','4850785078275458639A','4850785048222852477A','4850785078273433316A','4850785086859580591A','4850785082571415384A','4850785078281092993A',
        '4850785018151163332A','4850785091165282202A','4850785099771593948A','4850785048223716716A','4850785074018109225A','4850770870532291624A','4850770449634287483A','4850770814687239224A','4850770853339708565A','4850769105298558543A','4850769088113523989A','4850769088109782203A','4850769083823996574A','4850766566977922627A','4850766077342192990A','4850766068754793974A','4850766073050781655A','4850766051571150125A','4850101349561648694A','4850076391508352477A','4850068192396631085A','4850068218168345992A','4850068192429459037A','4850068158038989933A','4850068158036164409A','4850068097912759371A','4850068067850837041A','4850068042075324178A','4850068080730562407A','4850063012666065949A','4850061999051859324A','4850061999050439947A','4850061990487524670A','4850062007649614874A','4850062003366903150A','4850061956117965878A','4850062016231496942A','4850059323301943109A','4850059207363790820A','4850059254567442145A','4850059224507393973A','4850059280346634063A','4850059263165187217A','4850045042529519319A','4850043492041407568A','4850034202034378204A','4850034184862549284A','4850034141910246970A','4850034111836415224A','4850034133305562504A','4850034094666400917A','4850034103248869028A','4850034081770880502A','4850034094654406016A','4850034098943369075A','4850034073174189275A','4850034055998297176A','4850034068884668213A','4850034030251857107A','4850034051726237640A','4850034068882891923A','4850034038826056726A','4850034038825663732A','4850034081779537051A','4850034021643575094A','4850025899851601118A','4850025835429365712A','4850025882671081416A','4850025848336268580A','4850025869808592288A','4850025882670370500A','4850025839736032727A','4850025861202183759A','4850025844037947162A','4850025831156065335A','4850025844023435034A','4850025844019124102A','4850025801071975753A','4850025852619111718A','4850025865514058860A','4850025826855869980A','4850025865493661308A','4850025848315094626A','4850025813983061106A','4850025783904224520A','4850025813970372362A','4850025835441903208A','4850025826841879615A','4850025839721096943A','4850025792483169599A','4850025848320605191A','4850025822587361212A','4850025758149121330A','4850025792477382531A','4850025758131105158A','4850025788208174231A','4850025809660061238A','4850025783903044997A','4850025753825297627A','4850025813970705449A','4850025839729825760A','4850025805396428437A','4849366484935425940A','4849363100507752282A','4849363220758781029A','4849363113400801112A','4849363040372954519A','4849363057557439587A','4849363048958057482A','4849363036078671557A','4849348613576181211A','4849343695839237760A','4849342987167929866A','4849343111722816864A','4849343081660486819A','4849343090244640668A','4849343077364663668A','4849342974288643527A','4849343051602417608A','4849338696496010487A','4849338455979173273A','4849338430217061683A','4849338417321139551A','4849338382962612060A','4849338301363914489A','4849321739968232477A','4849321791504324550A','4849321744268875073A','4849321709897712994A','4849321748555771450A','4849321675540251689A','4849303550794513734A','4849303503535302127A','4849303512124319173A','4849303499241792774A','4849303512123383108A','4849303529304135032A','4849303417637691021A','4849303477769688974A','4849303499245970992A','4849303490648530806A','4849303499246453900A','4849299784110904532A','4849289480475247952A','4849289450406528263A','4849289437513450946A','4849289411746514737A','4849289321555549453A','4849289334445925593A','4849289360208024728A','4849289308669859321A','4849289270027880314A','4849289317260289342A','4849289347333166088A','4849289257135949694A','4849289270025115578A','4849289300079871572A','4849289325851223764A','4849289274310581614A','4849289325852432221A','4849289278603617613A','4849289295781477499A','4849289321563565428A','4849287281446935810A','4849287204132130559A','4849287191261552490A','4849287135416138878A','4849287161181646567A','4849287101054125465A','4849287109659632899A','4849287070991500731A','4849282750279058994A','4849282715899303172A','4849282621404550427A','4849282733083051466A','4849282707300663203A','4849282715904281822A','4849282694421784271A','4849282668645934231A','4849282106008905406A','4849282045876618874A','4849282045914580078A','4849282088831669864A','4849282028700522454A','4849006914564785316A','4849006983312190946A','4849006931757016819A','4849006802900330147A','4849006918864950342A','4849006905980280108A','4849006858730856270A','4849006854452332332A','4849006927461866730A','4848997259509749508A','4848997323909891653A','4848997250897526081A','4848997268070663324A','4848997238022457185A','4848965047228917302A','4848965077291287684A','4848964982818248374A','4848964952750986882A','4848960756560805551A','4848960692130929722A','4848960778029272163A','4848960700721978603A','4848960747967593888A','4848960722192338408A','4848957672777278777A','4848950070680345998A','4848949898884155162A','4848949795799838245A','4848949898875372712A','4848949890294858845A','4848949890285157559A','4848949920354938069A','4848942288192724570A','4848929450539277464A','4848926456947590489A','4848926031758003370A','4848926057510059527A','4848925993098875941A','4848926040330560793A','4848926031741574816A','4848925954443980683A','4848926010265616028A','4848925967327909241A','4848925984497271927A','4848925963044214362A','4848925920075328746A','4848925911493035910A','4848926001676279447A','4848925907220502088A','4848925950139358403A','4848925971613132701A','4848923390360004441A','4848921229992641740A','4848919228516437470A','4848918863439760682A','4848918781838607882A','4848918734596019212A','4848918730298481682A','4848918695954072973A','4848918691647018135A','4848918700235021742A','4848918670185555705A','4848918777541363439A','4848918674466973266A','4848918652990700753A','4848918691655276110A','4848918670171999952A','4848918665873679361A','4848918653003797743A','4848918670207999235A','4848918618643377835A','4848918640109094193A','4848915646513356329A','4848915431765480821A','4848915406002280090A','4848915375941051532A','4848915350173631661A','4848915307218320468A','4848915165478508149A','4848915148295837058A','4848915148301313181A','4848915144005828155A','4848915105355486781A','4848915083873803837A','4848915109650796241A','4848915105352603239A','4848915079592861367A','4848915105353811846A','4848915092462428132A','4848915101048624680A','4848915062406104464A','4848915105346149868A','4848915092463929027A','4848913335840130837A','4848913348741860676A','4848913215564874875A','4848913151137531483A','4848913164021841750A','4848913172615222682A','4848913099598344044A','4848913181204880760A','4848913125379778305A','4848913194091283982A','4848913172611763278A','4848913095319819296A','4848913121072604391A','4848913159743979055A','4848913151144019345A','4848913146861444890A','4848911098141595277A','4848910634293634537A','4848910625701174723A','4848910617111647628A','4848910621400094418A','4848910604221321160A','4848910642883155538A','4848910492551697414A','4848910569867763454A','4848576631885993000A','4848576640452765324A','4848576631859064331A','4848576524487362202A','4848576545962448217A','4848567268840365178A','4848567234490448950A','4848564971019746837A','4848564949546061331A','4848564885126262526A','4848564988202804627A','4848564928071599516A','4848559430547033747A','4848559439130168942A','4848559417657304782A','4848559409040964613A','4848559417656452737A','4848559439101630092A','4848559426222544616A','4848554650212965479A','4848550479812542050A','4848549685236455223A','4848546992326491512A','4848546996600606237A','4848546936452073187A','4848546923575999622A','4848546957932907716A','4848546910682482381A','4848546816194381498A','4848546867747917400A','4848546846264729439A','4848546914992840340A','4848546829102013789A','4848546799023150092A','4848546841969393027A','4848546854851183689A','4848546837667816638A','4848546829079302098A','4848546914980423614A','4848545562078287020A','4848544900641922954A','4848544874872506051A','4848544844817831634A','4848544853395094858A','4848544849106896580A','4848544866286288612A','4848544844805057895A','4848544857693192080A','4848544861984368607A','4848544840552005321A','4848544788986271036A','4848544844822707652A','4848544836238347858A','4848544853413219637A','4848544857695364918A','4848544844807109916A','4848544861984963720A','4848544849117412417A','4848544823340481702A','4848544840519827275A','4848544844820170380A','4848544823349175537A','4848541799676239273A','4848541756724991964A','4848541765311323183A','4848541778205728052A','4848541730952774886A','4852283613836650245A','4852267404629497744A','4851920289667597634A','4851899124091656054A','4851553830183674908A','4851178540233203183A','4851175581001913484A','4851171724115420723A','4851164530053006902A','4851158182098216666A','4851143660805801401A','4851142965025818085A','4851142904894674602A','4850088924202938309A','4850029318649863998A','4852291954668164601A','4852289523723625485A','4852288196569646652A','4852286800700753052A','4852286757757837167A','4852286422748114912A','4852286143595107857A','4852285288879166639A','4852284799270116889A','4852284803559507611A','4852279756961874995A','4852276681773794886A','4852276522849832186A','4852276132017723009A','4852276071889803142A','4852270076112461600A','4852269796958678495A','4852269659487901459A','4852269234285648947A','4852212974509210818A','4851894476926496462A','4851553619729106497A','4851553151567388056A','4851184003437682028A','4851178213825299559A','4851150674503886579A','4851148939320452407A','4851148638682654345A','4851148368088319516A','4851147947194170682A','4851147650821507009A','4851138262020505558A','4851506160329723484A','4851180765020013808A','4852284107772896704A','4852279396177389461A','4852279426247331727A','4852279301687592329A','4852279267363503567A','4852269036718927197A','4852256529776058072A','4852256504003823246A','4852256443897884124A','4852256452477359105A','4852256448185687656A','4852256435307071294A','4852256430996494133A','4851896654472339100A','4851890203419460870A','4851889808299384779A','4851888549862925910A','4851887789666456714A','4851887789655327975A','4851887768189388596A','4851887772470750662A','4851887768195503511A','4851887755317460120A','4851887763907782267A','4851882313583142503A','4851882167539670529A','4851882158957445006A','4851882128887031730A','4851882163242116460A','4851882180427896132A','4851882150388868953A','4851882167540241707A','4851881871200659085A','4851881901254559181A','4851881884071434212A','4851881871206497967A','4851553478002562664A','4851553477988258838A','4851553344850404417A','4851553142988193355A','4851523271485603169A','4851523181287738887A','4851523043861061230A','4851521330171853840A','4851521072476490888A','4851520398166244375A','4851519762502762042A','4851515261375288899A','4851515248514340386A','4851515239908676729A','4851515257070245542A','4851515257071328597A','4851515239902594982A','4851515257105417230A','4851515252791006534A','4851515244191139349A','4851515244191603822A','4851515261396977300A','4851515227013469978A','4851515248499302261A','4851515218427625373A','4851515231317632077A','4851515239912137979A','4851512044441615891A','4851512035864434387A','4851512057337005348A','4851512005786672210A','4851512001508969664A','4851511988618469116A','4851511975740032675A','4851511997209492810A','4851512018672469046A','4851511967137324466A','4851511894135790634A','4851511992924623973A','4851511958545808870A','4851511949963988929A','4851511971433010485A','4851511954244359239A','4851511954260977152A','4851511937085851040A','4851511967131067814A','4851510210491170274A','4851510214792298312A','4851510206199488006A','4851510184720014469A','4851510227672761757A','4851510249153222534A','4851510197601949073A','4851510184720514235A','4851510189013820908A','4851175443569661277A','4851175250283904994A','4851175237398021121A','4851175228817577128A','4851175271760205623A','4851175228822949188A','4851175237406604888A','4851175198739449515A','4851174983994659918A','4851174966836927813A','4851174949635134788A','4851174983998162865A','4851174945344896659A','4851174958223762531A','4851174958234803923A','4851174979696289092A','4851167669671616140A','4851167678278387101A','4851167691138339962A','4851167656792473031A','4851167669667020294A','4851167605236969216A','4851167656794768618A','4851153126906846999A','4851153504869663963A','4851153483396189768A','4851153470501930731A','4851153487680617826A','4851153410405504925A','4851153526341096911A','4851153491978821541A','4851153479100442460A','4851153491975613485A','4851145584961389708A','4851142724491132385A','4851138502540896053A','4851138090232306902A','4851137918428786306A','4851137841117779053A','4851137828244817557A','4851137914129835339A','4851137888372041700A','4851137892656702874A','4851137892677042002A','4851137888367816545A','4851137875477517928A','4851137798181573979A','4851137793895685391A','4851137755238679639A','4851137738042283460A','4851137643569077691A','4851137716584168631A','4851137716571821432A','4851137720884921503A','4851137677922378987A','4851137699382994403A','4851137708004513127A','4851137634990150844A','4851137652168496274A','4851137656438392799A','4851137600630414346A','4851137652156174079A','4851137647842649408A','4851137652161382282A','4851137634974338258A','4851137643565327605A','4851137639290152588A','4851137626372750936A','4851137626371958578A','4851137617775203622A','4851137609190380917A','4851137592015396813A','4851137613502027734A','4851137566248096883A','4851137592027680317A','4851137604893005778A','4851137596322098850A','4851137566260444749A','4851137566248101342A','4851137583417370361A','4851137596325567558A','4851137583418086776A','4851137600602150601A','4851137570542227359A','4851137596305352072A','4851137587734582405A','4851137497535026240A','4851137574837346216A','4851137566279951967A','4851137583431978105A','4851137497534633612A','4851137072332670139A','4851137587715335225A','4851137574829800488A','4851137592014276509A','4851137604897353175A','4851137561945291927A','4851137549074415193A','4851137592019160254A','4851137566245344958A','4851137579132241818A','4851137579121234976A','4851137570532736591A','4851137579124403292A','4851137570540608893A','4851137553365845214A','4851137484634850680A','4852277506446663135A','4851895542102926923A'];



$sql = "select pid from sync_douyin_order_info where pid in ('".implode("','", $pre_ids)."')";
$ids = $oms_sync_db->getCol($sql);
var_dump(array_diff($pre_ids,$ids));
foreach (array_diff($pre_ids,$ids) as $id) {
   $result = postJsonData('http://100.65.130.195:11353/order/downloadSingleOrder', json_encode(['platform_shop_id'=>1992,'platform_order_sn'=>$id]),0);
}

function postJsonData($url, $data) {
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_TIMEOUT,3*60*60);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
    curl_setopt($ch, CURLOPT_HTTPHEADER, array(
            'Content-Type: application/json; charset=utf-8',
            'Content-Length: ' . strlen($data))
    );
    $time_start = microtime(true);

    ob_start();
    curl_exec($ch);
    $return_content = ob_get_contents();
    ob_end_clean();
    
    $result = json_decode($return_content, true);
    if(isset($result['code']) && $result['code'] == 0) {
        $str = "[ExpressApiService][ok] url {$url},data".json_encode($data).",response:".json_encode($result);
    }else{
        $str = "[ExpressApiService][error] url {$url},data".json_encode($data).",response:".json_encode($result);
    }
    $time_end = microtime(true);
    $time = $time_end - $time_start;
    echo date("Y-m-d H:i:s").' '.(date("Y-m-d H:i:s") .$str." cost {$time}  \r\n");
    return  $result;
}
 