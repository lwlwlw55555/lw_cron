<?php
require("includes/init.php");
require("Models/ShopModel.php");
require("Models/OrderModel.php");
include 'request/LogisticsOnlineSendRequest.php';
use Models\ShopModel;
use Models\OrderModel;
require("Services/ExpressApiService.php");
use Services\ExpressApiService;
include 'request/OrderNumberListGetRequest.php';
include 'PddClient.php';

global $sync_db;


$pre_ids = ['4857946846047608138A','4857946846047608138A','4857946846047608138A','4857946846047608138A','4857946846047608138A','4857946846047608138A','4857610674660286329A','4857610867933976441A','4857611078384549753A','4857610940948920185A','4857607406191228265A','4857607659593596265A','4857606963810506089A','4857216267817365238A','4857216207691802358A','4857212625678976758A','4857236694674939644A','4857236694674939644A','4857236694674939644A','4857606242253098511A','4857607079769054735A','4857607835686800911A','4857608690384813667A','4856454224647470691A','4857612353994403427A','4857600641612693248A','4857600641612693248A','4857600641612693248A','4857603540728157468A','4857603540728157468A','4857603540728157468A','4857129122925706895A','4856864256586008207A','4856863539331772047A','4857215709479726104A','4857215559143556120A','4857215267090084888A','4857608196465464334A','4857607633823468558A','4857610120608588814A','4857752030631092169A','4857751343428460489A','4857752206715176905A','4857939420054816699A','4857939420054816699A','4857939420054816699A','4856854837730364754A','4856481927188125010A','4856735652380130642A','4857600212122050259A','4857742341189174995A','4857597811248162515A','4857604880746260323A','4857605035368324963A','4857605765512318819A','4857588525509711783A','4857580983550726055A','4857587090991947687A','4857936499470425963A','4857937083584409451A','4857937543163035499A','4857218771787330954A','4857219768214173066A','4857219072431408522A','4856879525200456838A','4856879525200456838A','4857236394028125760A','4857236394028125760A','4856478469771739035A','4856477542048710555A','4856499622456054973A','4856498291018695869A','4856863779849678491A','4856863779849678491A','4856866683242217270A','4856496066225506102A','4857206793111672695A','4857207501784962935A','4857207926986218979A','4857209460294751715A','4857209670743866671A','4857209670743866671A','4857213209795346203A','4857212415239560987A','4857214403799328342A','4857216950721554006A','4857232438368016205A','4857232438368016205A','4857233456273401101A','4857233456273401101A','4857492206578052103A','4857492206578052103A','4857573613401992430A','4857572629851028718A','4857602896473755547A','4857601668109948827A','4857601204253574373A','4857601204253574373A','4857608522881205527A','4857608780581836055A','4857603330270776924A','4857603562197208668A','4857605159921374580A','4857943637706919284A','4858139037241851367A','4857951561920630247A','4857987467843587548A','4856850852003202524A','4857217045206189881A','4857211990035433273A','4856832422291309789A','4856833448791997661A','4856834690054500323A','4856835424487712739A','4856849692362989352A','4857560715606480680A','4857202983479647998A','4857204319226287870A','4857206698640238439A','4857206698640238439A','4857569172396494199A','4857569120858228087A','4857569911127187034A','4857568360644806234A','4857948310633205076A','4857948310633205076A','4857213274221720669A','4857209361502895197A','4857586528354315828A','4857591789694473780A','4856828084384734483A','4856828084384734483A','4857576731530397472A','4857575838176778016A','4857599284407526826A','4857599254350099882A','4857564800110802518A','4857420854353663574A','4857205607713095206A','4857949397265905190A','4857502991237957267A','4857503897474190995A','4857611327494164097A','4857608471342749313A','4857202420849339949A','4857200067231049261A','4857903239242772327A','4857941099375585127A','4857227353132242655A','4857227353132242655A','4857566062834208639A','4857566457985501055A','4857613711202002852A','4857613517942464420A','4857570259040634800A','4857573196801619888A','4857578754516018908A','4857578754516018908A','4857612070521360271A','4857611383327049615A','4857612714771709360A','4857612998238274992A','4857210611342128913A','4857211083805220625A','4857234843548396967A','4857234006032074151A','4857568661314975569A','4857218844792782673A','4857596080374775657A','4857596080374775657A','4857959980065976082A','4857949539004122898A','4857612160725878617A','4857611310315900761A','4857943830974789468A','4857943148077625180A','4857943431550664540A','4857941906835066716A','4856476468328062561A','4856476468328062561A','4856827985588113128A','4856828333494306536A','4856852123312578094A','4856860614467307054A','4857576993523490158A','4856856220706477422A','4856862577256041552A','4856864243700802640A','4856864814954858446A','4856864814954858446A','4857206178938045740A','4857205766622897452A','4857566711397393899A','4857578114521302507A','4856402805317508825A','4856402805317508825A','4856480097532990677A','4856481519200050389A','4856455788028026197A','4856486260820759893A','4856681217968975063A','4856681217968975063A','4856825537461357819A','4857936344853431547A','4856844259221258086A','4856844396659973990A','4856851324443137423A','4856855542096266639A','4856991804230647397A','4856857534981842533A','4857210791731649673A','4857210791731649673A','4857422482097106016A','4857422482097106016A','4857567905374977644A','4857566479461103212A','4857934699885743635A','4857583070906142227A','4856477572096042980A','4856477404591151076A','4856500116524883087A','4856500112147944591A','4856826555362602786A','4856826057151909666A','4857205873995185845A','4857205873995185845A','4857214506873785937A','4857214648610209361A','4857495603895936121A','4857249055595246713A','4857604223621518340A','4857604223621518340A','4857954259174688366A','4857954362244671086A','4858125628349996312A','4858125628349996312A','4856460637047349129A','4856865850020167106A','4856865420531793346A','4857238489971703493A','4857238030414233285A','4857513625591250674A','4857606856433092018A','4857606147760543154A','4857098727444230030A','4857216856225889951A','4857216697311501983A','4857940657016642728A','4857940657016642728A','4857204327810204684A','4857230797686552070A','4857230617295568390A','4857852983832276810A','4857852983832276810A','4857229947292947900A','4857229865677004220A','4857944763006717666A','4858134192530275672A','4858149065999146696A','4857227937250758051A','4856483954422693470A','4858203229820186287A','4858189709270910660A','4857951299926885767A','4858232731981532959A','4857786248627595227A','4857938135880789770A','4857235874338066004A','4857582121714484263A','4857612401241169289A','4857599327364217998A','4857924065539875949A','4856490800589495354A','4856495434910784527A','4856495817117783287A','4856496676107691940A','4856498930964080155A','4856500120912731771A','4856642223975999257A','4856654404537656952A','4856786612171554091A','4856821173777711053A','4856821268286907753A','4856821444367407075A','4856822913233020354A','4856823097929835915A','4856824309122153814A','4856824455133017335A','4856825683487823274A','4856827959818356168A','4856828007077477704A','4856828616958046166A','4856829699296230794A','4856830253339063979A','4856830279099162453A','4856830957717980616A','4856831120952434161A','4856831460238175884A','4856831537529669499A','4856831906900163982A','4856832198959318916A','4856833375779382789A','4856834664295404637A','4856843653628069554A','4856845040901625458A','4856846501195345112A','4856848713105581519A','4856849185560910927A','4856853055335408658A','4856857603692248081A','4856857942999144382A','4856861331724650077A','4856862637386153074A','4856862611622698874A','4856862718989401261A','4856862852145022531A','4856863023930060276A','4856863638112316942A','4856864698967297043A','4856864617368007990A','4856864711858961823A','4856865996052139923A','4856866094834570292A','4856868689000602670A','4856868946691318844A','4856864965259655063A','4856870870836751876A','4856870862258101442A','4856871094177615120A','4857014034986499672A','4857014172418600349A','4857056679711377215A','4857202476674779094A','4857203481696845101A','4857205307060186271A','4857204993536701696A','4857205689312781918A','4857205826748368669A','4857206410891812626A','4857207239811034292A','4857205736550356737A','4857207596289424766A','4857206866133806698A','4857208833244257844A','4857209258435417289A','4857209606331220992A','4857207896923058128A','4857210426673149062A','4857208562651826055A','4857208781683727773A','4857211191161141116A','4857211663607045304A','4857212286388714992A','4857212964984547028A','4857211229821533621A','4857213244154523570A','4857213476082064690A','4857211749511140425A','4857213570588808641A','4857214124637936883A','4857212239129771206A','4857212260609377362A','4857215065232305699A','4857214609958983145A','4857217294316568543A','4857217427463330887A','4857217835481808765A','4857217689449412380A','4857218544145482973A','4857216641474919854A','4857216486863732563A','4857217573487867581A','4857218299332134445A','4857221812622895040A','4857222495516636790A','4857221885629205920A','4857229504900656335A','4857237545082985777A','4857238288107884360A','4857238859338951806A','4857238704723281763A','4857350605796763404A','4857416344586171954A','4857430419173644087A','4857562699895773147A','4857563120781326010A','4857565362757092368A','4857565946871037450A','4857566191679792970A','4857564143057479004A','4857567480180379170A','4857566599719255639A','4857568085780520581A','4857565878159386140A','4857566823065454235A','4857572982028707293A','4857582439542857225A','4857585239865342990A','4857583899848548014A','4857601483433218009A','4857599069660038267A','4857604434070156661A','4857605748328787508A','4857600401102106026A','4857608359673201712A','4857613981780936521A','4857728906520469437A','4857936044201678381A','4857937843797456242A','4857938483745179096A','4857939626217051730A','4857941168097779513A','4857942860313022325A','4857944234702669175A','4857944324907222814A','4857945295583268055A','4857946712933592668A','4857951566220209847A','4856102737425466863A','4856108814808702814A','4856109381733295884A','4856109798335579901A','4856116120610538947A','4856117383258662844A','4856118435519616331A','4856118577251575705A','4856118933733942297A','4856119444848807393A','4856119479197803755A','4856121965980409144A','4856122872221783996A','4856123194344529849A','4856123275961173917A','4856124560140715949A','4856113341683654445A','4856456668507921725A','4856457866820238793A','4856458283406245781A','4856458523967470891A','4856458532532444818A','4856459782338285084A','4856455762275948179A','4856459915493564351A','4856456354998050331A','4856461925543742947A','4856462256242795816A','4856459236903343969A','4856464695802795489A','4856477172674680576A','4856478504150345182A','4856479788298648995A','4856481209930792381A','4856482275095307974A','4856482562851413645A','4856484452628946655A','4856487983094518839A','4856488232198987129A','4856494365412534140A','4856494734781011119A','4856496835031842028A','4856497337532458199A','4856738405462914791A','4856822277580609021A','4856822900353474325A','4856823557482278269A','4856824047107512284A','4856824734298259328A','4856825988427037887A','4856826177406037251A','4856827397175172278A','4856828612661937260A','4856829059335570606A','4856831576187946209A','4856831889727278416A','4856832692897592429A','4856832714350872529A','4856833062238972973A','4856833697897168827A','4856834806011018471A','4856841222677697702A','4856845414564244836A','4856844594228215658A','4856846647226273448A','4856847325826465358A','4856849370234987672A','4856849511981235272A','4856850967967342311A','4856851380277421713A','4856851625086223868A','4856851698101900900A','4856853265763458595A','4856853776869813954A','4856856100449946893A','4856857663813403671A','4856857762598180024A','4856857573630623370A','4856858260812520717A','4856859570779176009A','4856859605141657388A','4856860485607521557A','4856861705377078486A','4856861984552097476A','4856862268016641566A','4856862925149574180A','4856863410482390454A','4856863522157428639A','4856863638112517549A','4856864149218602044A','4856865596618008082A','4856865622391864422A','4856869015413640467A','4856871111355516894A','4857069341288680845A','4857155945011145956A','4857179799256352679A','4857198001317391939A','4857201119463806778A','4857201725056341954A','4857200316301984936A','4857200745799642388A','4857202970600348924A','4857203936959835256A','4857205088018584996A','4857204168887059897A','4857205388661169778A','4857204542556566795A','4857206303493068356A','4857207720826355299A','4857207746595067834A','4857206432335857165A','4857208201868178885A','4857206410870148159A','4857210233380554020A','4857210216208287157A','4857211212638756028A','4857211234112507848A','4857210306398170912A','4857212415223701373A','4857210439541019664A','4857212754526749740A','4857214695862060631A','4857212548392140315A','4857216010117690678A','4857213909891642951A','4857214098855775861A','4857216370896377282A','4857216650066308376A','4857216761731829145A','4857217324392830380A','4857217826896197441A','4857219811166903322A','4857217487580183810A','4857219815457253206A','4857216053065766005A','4857231974510222987A','4857238412660447040A','4857244305368655017A','4857420819989992840A','4857442646949142390A','4857450047213016907A','4857477221435326036A','4857498223824772794A','4857563434337008827A','4857566732871402841A','4857567175230508820A','4857567231073951313A','4857569653442557849A','4857570366391992285A','4857572737224396588A','4857577964195132880A','4857577964214697610A','4857576525384647770A','4857576976357631813A','4857578728699727644A','4857580253407422125A','4857580223346034285A','4857581146793577513A','4857583753804580108A','4857594912141143680A','4857597158398846474A','4857594469745991431A','4857594383867899871A','4857607200032789660A','4857606650280266821A','4857757158816947226A','4857855513586077406A','4857936005552292990A','4857939196723660579A','4857942929096154114A','4857943259755320512A','4857944844597567201A','4857945196783535327A','4857946824568800942A','4857951647821962746A','4857957536225844471A','4857957862644157994A','4858103470614514842A','4858123571068882163A','4858125246098112237A','4858177309713722531A','4858187003436584875A','4858217660912072562A','4856457205385398074A','4856459795219662411A','4856457845305333649A','4856478001599194190A','4856478302243591577A','4856482614396726560A','4856482859197994807A','4856483980183431030A','4856485818439477042A','4856497058360712462A','4856498123530806447A','4856667714597963638A','4856822135863018884A','4856822866000428121A','4856824961929727437A','4856825640537588920A','4856826405054750437A','4856826426517397182A','4856829183891997845A','4856829596210085696A','4856830871824424473A','4856831142390122015A','4856831202537678162A','4856831455945670379A','4856832757306393667A',
'4856844529802810772A','4856844594235405491A','4856848141885275446A','4856849606453065346A','4856851298678910778A','4856851431825672143A','4856851861325202664A','4856859682444975298A','4856862083337436291A','4856863964529262165A','4856865304558016157A','4856866197914975955A','4856866451317243670A','4856868568734475426A','4856869303171329288A','4856872734854092083A','4856873357626521545A','4856879748535029047A','4857031910637186870A','4857082741575397107A','4857097808320966276A','4857120846523314146A','4857201299861569274A','4857203829589179405A','4857202983487057460A','4857205775214751341A','4857203945552156386A','4857206355028948560A','4857206986399039261A','4857205547575291742A','4857207905512963981A','4857206866131945056A','4857207188262984704A','4857209026513509444A','4857208717262603991A','4857207540439135602A','4857207669287664770A','4857207871157366738A','4857211676507186848A','4857212303557205713A','4857213609226447967A','4857214910610001260A','4857215340100242483A','4857217199829929009A','4857217805434099430A','4857220743177523091A','4857232356762486284A','4857233559347965388A','4857375280396375242A','4857427769178824251A','4857524453196414409A','4857563425775185033A','4857569760809535040A','4857572011368042070A','4857573226836291128A','4857575421566561518A','4857584758834900324A','4857589547718092537A','4857594018785107116A','4857599928650257614A','4857605529285932938A','4857600710333267434A','4857606018924299545A','4857609854323790949A','4857612289565471889A','4857635817397587396A','4857660272940228570A','4857937044944852699A','4857940145899717829A','4857939802302872752A','4857940931876296250A','4857941073608639730A','4857948263397187179A','4857957381599174100A','4858154769710202628A','4858179251018513925A','4858230691840763626A','4856457226847444456A','4856454456646417912A','4856460134551782501A','4856460628473259876A','4856461053716440520A','4856463175410564442A','4856464725854115103A','4856465632099622486A','4856474698787395395A','4856475935725358811A','4856477078175211039A','4856481025257233901A','4856474539862787682A','4856482687396552573A','4856485234312025512A','4856485427588046580A','4856487540718638312A','4856488919395554907A','4856478916415897541A','4856489911550584318A','4856495129918712910A','4856495117035460071A','4856499016866813788A','4856500017604533651A','4856501061272971044A','4856646561900336765A','4856823424362681697A','4856828574020388522A','4856833036471708842A','4856826271909398413A','4856833801017103840A','4856837546187413444A','4856843902747780607A','4856846342288913939A','4856848691626866372A','4856851779709385902A','4856854008796560836A','4856854434000623199A','4856859162758655785A','4856859888632360891A','4856860610161585558A','4856861194278159574A','4856861585121281737A','4856863393298781814A','4856864101966636323A','4856864153508677535A','4856864011790040912A','4856864290952842634A','4856865132771243092A','4856865841432983372A','4856867731215157212A','4856977377443876426A','4857037292228865312A','4857051439855031812A','4857050237267463263A','4857201308438392311A','4857203168178003308A','4857204336399820175A','4857204478135334198A','4857205341412977841A','4857206264844312229A','4857209606344766779A','4857211049425807298A','4857211148211152111A','4857211272764247392A','4857211354367335454A','4857211856882218827A','4857212591335359827A','4857213488970769919A','4857211792457391279A','4857212054452370438A','4857215417421841651A','4857215683695662817A','4857213699426073726A','4857213639290144704A','4857216392374653999A','4857214515464122106A','4857219394556537995A','4857219458993292868A','4857221370230539528A','4857221894220027068A','4857222761802297237A','4857221207025372687A','4857231231477929714A','4857237583735094874A','4857238236571954689A','4857239258772852116A','4857235608048676132A','4857235968830139903A','4857396519000334090A','4857466256387871877A','4857505460847760742A','4857567024914957934A','4857568352093095227A','4857569481635005768A','4857572303449304970A','4857573231134483837A','4857577530402479523A','4857576503901306716A','4857576834620576821A','4857581529015811236A','4857579789550606151A','4857582808916575913A','4857582057289512554A','4857591308659418300A','4857598146242766294A','4857601041048330160A','4857605043955909897A','4857607036823549142A','4857609407640911030A','4857604124831649261A','4857604369650005964A','4857604494210219112A','4857606345338471521A','4857614295314902567A','4857759954840110246A','4857936533843138271A','4857941898249899815A','4857942933486966639A','4857945785187018252A','4857952021482325404A','4857952197573115499A','4858106386899246791A','4858229321748436873A','4856843451772007440A','4856844546994193844A','4856849245678403017A','4856850461151815155A','4856856654504959970A','4856856950855017990A','4856859854251720599A','4856862521419300036A','4856863590868659275A','4856863973123765365A','4856865686812163828A','4856864737626781418A','4857141960581891709A','4857187491530659488A','4857206178942129584A','4857208021502500344A','4857211354397818255A','4857212810363591760A','4857211216939900236A','4857215013696851058A','4857219450381725476A','4857220060265492127A','4857220751769810822A','4857224999478222027A','4857238086248875460A','4857238172148504546A','4857233267290396160A','4857409889229768358A','4857573596224697746A','4857577444510064559A','4857576808851924656A','4857577586241559971A','4857577934122792779A','4857580313540848702A','4857581030796629197A','4857583320014214624A','4857591940013372731A','4857599713901786914A','4857600078977818028A','4857604889338316143A','4857600517069380776A','4857603845664188114A','4857603776939794283A','4857611963149801286A','4857915711827072427A','4858104295257681316A','4858137452400465532A','4858231529359344950A','4857237128469488863A','4857243691179970081A','4857420875793839677A','4857576383645894069A','4857595448998813073A','4857593662301957852A','4857595032390897610A','4857605834233282323A','4857939875324696267A','4857951617764693594A','4856832632759387683A','4857216671541710563A','4857238129199372216A','4857562631159559852A','4857569919724123990A','4857572316306585320A','4857572427981264786A','4857578234783116892A','4857579231223402046A','4857581516143965297A','4857583882657781646A','4857582040117896906A','4857604232205642967A','4857606066158739404A','4857607225798082039A','4857603811310921506A','4857610438433180753A','4857604545749994870A','4857736959590638964A','4857872418553435915A','4857896693720230977A','4857936589662576610A','4857949736557993514A','4856855885694968914A','4857202356421559367A','4857205770930530082A','4857206127397963453A','4857210525447059273A','4857208670022022217A','4857211019369847825A','4857209945617650698A','4857215009389059833A','4857216693016163850A','4857216787512454669A','4857220206300208240A','4857221348763317964A','4857240203663522917A','4857415824886813728A','4857422258739171223A','4857516365764171309A','4857569954078295042A','4857574274813375719A','4857577440216299033A','4857576009992848810A','4857577753741807220A','4857580936309131000A','4857579587690102001A','4857582585576404534A','4857581597746414635A','4857583856891821559A','4857589259960673818A','4857593700954684892A','4857598043158543491A','4857597605073485354A','4857600658794755566A','4857607655295466883A','4857611168590085874A','4857917292383756000A','4857935198109262969A','4857935434316924377A','4857942972057257698A','4857951703677460324A','4858159859242220818A','4857209172524477851A','4857212788891238369A','4857214863359491525A','4857213415956340456A','4857236527175712663A','4857437879535605431A','4857571770868211060A','4857574446619090002A','4857575644915580351A','4857593756782208707A','4857594495527144637A','4857593383122597451A','4857599524926394050A','4857608110566514373A','4857801092040587073A','4857935829456506196A','4857937465840910182A','4858004909704249225A','4857230600117634476A','4857940034225227698A','4858133093007713902A','4857962883463894914A','4857225102562733542A','4857225214238314377A','4857229199961306692A','4857230058959946755A','4857231149873118353A','4857231325970580777A','4857231686742214167A','4857227920058422285A','4857227490572664458A','4857229436185136400A','4857234207893540187A','4857235187140330681A','4857288414672223780A','4857950801712895906A','4857600542828715214A','4858230313887090202A'];



$sql = "select pid from sync_douyin_order_info where pid in ('".implode("','", $pre_ids)."')";
$ids = $sync_db->getCol($sql);
$shop_id = $sync_db->getOne("select shop_id from sync_douyin_order_info where pid = '{$pre_ids[0]}'");
var_dump(array_diff($pre_ids,$ids));
foreach (array_diff($pre_ids,$ids) as $id) {
   $result = postJsonData('http://100.65.132.5:10314/order/downloadSingleOrder', json_encode(['platform_shop_id'=>$shop_id,'platform_order_sn'=>$id]),0);
}

function postJsonData($url, $data) {
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_TIMEOUT,3*60*60);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
    curl_setopt($ch, CURLOPT_HTTPHEADER, array(
            'Content-Type: application/json; charset=utf-8',
            'Content-Length: ' . strlen($data))
    );
    $time_start = microtime(true);

    ob_start();
    curl_exec($ch);
    $return_content = ob_get_contents();
    ob_end_clean();
    
    $result = json_decode($return_content, true);
    if(isset($result['code']) && $result['code'] == 0) {
        $str = "[ExpressApiService][ok] url {$url},data".json_encode($data).",response:".json_encode($result);
    }else{
        $str = "[ExpressApiService][error] url {$url},data".json_encode($data).",response:".json_encode($result);
    }
    $time_end = microtime(true);
    $time = $time_end - $time_start;
    echo date("Y-m-d H:i:s").' '.(date("Y-m-d H:i:s") .$str." cost {$time}  \r\n");
    return  $result;
}
 